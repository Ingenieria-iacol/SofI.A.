<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Entalpía Hub - Generador de Cuentas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --blue: #002855; --cyan: #00a8e8; }
        body { background: #f0f2f5; font-family: sans-serif; }
        .header-entalpia { background: var(--blue); color: white; padding: 20px; border-bottom: 4px solid var(--cyan); }
        .card { border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 12px; }
        .btn-primary { background: var(--blue); border: none; }
        .btn-primary:hover { background: var(--cyan); }
    </style>
</head>
<body>

<div class="header-entalpia text-center mb-5">
    <h1>ENTALPÍA HUB</h1>
    <p>Ingeniería y Gestión de Proyectos</p>
</div>

<div class="container mb-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card p-4">
                <h3 class="text-center mb-4">Nueva Cuenta de Cobro</h3>
                
                <div class="mb-3">
                    <label>Nombre del Deudor</label>
                    <input type="text" id="nombreDeudor" class="form-control" placeholder="Ej: Universidad Nacional">
                </div>
                <div class="mb-3">
                    <label>NIT / CC</label>
                    <input type="text" id="nitDeudor" class="form-control" placeholder="000.000.000-0">
                </div>

                <h5>Conceptos</h5>
                <div id="lista-conceptos">
                    <div class="row g-2 mb-2 item-cobro">
                        <div class="col-8"><input type="text" class="form-control desc" placeholder="Descripción"></div>
                        <div class="col-4"><input type="number" class="form-control monto" placeholder="Valor"></div>
                    </div>
                </div>
                <button class="btn btn-sm btn-outline-info mt-2" onclick="addFila()">+ Agregar Fila</button>

                <hr class="my-4">
                <button class="btn btn-primary w-100 p-3" onclick="enviar()">GENERAR DOCUMENTO Y AUDITAR</button>
                
                <div id="respuesta" class="mt-3 text-center"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbymMFR1V2Ewfz6OG9GAd1ISFXvMm6ZxsTQGP1PynwtQOyYhlJ3k-PkU2wEHny_ZJ5hJ/exec";

    function addFila() {
        const row = document.createElement('div');
        row.className = "row g-2 mb-2 item-cobro";
        row.innerHTML = `<div class="col-8"><input type="text" class="form-control desc" placeholder="Descripción"></div>
                         <div class="col-4"><input type="number" class="form-control monto" placeholder="Valor"></div>`;
        document.getElementById('lista-conceptos').appendChild(row);
    }

    async function enviar() {
        const respDiv = document.getElementById('respuesta');
        respDiv.innerHTML = "⌛ Conectando con el servidor de Entalpía...";
        
        const data = {
            nombreDeudor: document.getElementById('nombreDeudor').value,
            nitDeudor: document.getElementById('nitDeudor').value,
            conceptos: [],
            total: 0
        };

        document.querySelectorAll('.item-cobro').forEach(el => {
            const d = el.querySelector('.desc').value;
            const m = parseFloat(el.querySelector('.monto').value) || 0;
            if(d) { data.conceptos.push({descripcion: d, monto: m}); data.total += m; }
        });

        const response = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        });
        
        const res = await response.json();
        respDiv.innerHTML = `<a href="${res.url}" target="_blank" class="btn btn-success">✅ Descargar PDF</a>`;
    }
</script>
</body>
</html>
