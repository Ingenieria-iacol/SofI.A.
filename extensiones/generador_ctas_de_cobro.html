<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Cuentas | Hub de Ingeniería</title>
    <style>
        :root {
            --bg: #0d1117;
            --card: #161b22;
            --accent: #58a6ff;
            --text: #c9d1d9;
            --input: #0d1117;
        }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma; display: flex; justify-content: center; padding: 20px; }
        .hub-card { background: var(--card); border: 1px solid #30363d; border-radius: 10px; padding: 30px; width: 100%; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: var(--accent); border-bottom: 1px solid #30363d; padding-bottom: 10px; margin-top: 0; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.9em; margin-bottom: 5px; color: #8b949e; }
        input, textarea { width: 100%; background: var(--input); border: 1px solid #30363d; color: white; padding: 10px; border-radius: 6px; box-sizing: border-box; }
        input:focus { border-color: var(--accent); outline: none; }
        button { background: var(--accent); color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        button:hover { opacity: 0.9; }
        .footer-brand { text-align: center; font-size: 0.8em; margin-top: 20px; color: #484f58; }
    </style>
</head>
<body>
    <div class="hub-card">
        <h2>Hub de Ingeniería</h2>
        <div class="form-group">
            <label>Logo de la empresa</label>
            <input type="file" id="logo" accept="image/*">
        </div>
        <input type="text" id="deudor" placeholder="Nombre del deudor" class="form-group">
        <input type="text" id="nit" placeholder="NIT / Cédula" class="form-group">
        <input type="number" id="monto" placeholder="Monto en números" class="form-group">
        <input type="email" id="email" placeholder="Email para envío automático" class="form-group">
        <input type="text" id="beneficiario" placeholder="Nombre del beneficiario" class="form-group">
        <textarea id="conceptos" rows="3" placeholder="Conceptos del cobro..."></textarea>
        <textarea id="novedades" rows="2" placeholder="Novedades o notas adicionales..."></textarea>
        
        <button id="btnGenerar">GENERAR Y REGISTRAR</button>
        
        <div class="footer-brand">ENTALPIA 2025</div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxSykT2LXs9fox-5knM-l4QXe_q4M7Qcgl8SKHIEy63O6dWB5lgerMu3lQLntpQs9yP/exec';

        document.getElementById('btnGenerar').onclick = async function() {
            this.innerText = 'PROCESANDO...';
            this.disabled = true;

            const logoFile = document.getElementById('logo').files[0];
            const logoBase64 = logoFile ? await toBase64(logoFile) : "";

            const payload = {
                deudor: document.getElementById('deudor').value,
                nit: document.getElementById('nit').value,
                monto: document.getElementById('monto').value,
                email: document.getElementById('email').value,
                beneficiario: document.getElementById('beneficiario').value,
                conceptos: document.getElementById('conceptos').value,
                novedades: document.getElementById('novedades').value,
                logo: logoBase64
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                
                if(result.status === 'success') {
                    const link = document.createElement('a');
                    link.href = 'data:application/pdf;base64,' + result.pdf;
                    link.download = `Cuenta_${payload.deudor}.pdf`;
                    link.click();
                    alert('¡Cuenta generada, registrada y enviada!');
                }
            } catch (e) {
                console.error(e);
                alert('Error en la conexión con el Hub.');
            }
            this.innerText = 'GENERAR Y REGISTRAR';
            this.disabled = false;
        };

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    </script>
</body>
</html>
